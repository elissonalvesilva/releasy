# ------------------------------------------
# ðŸš€ Stage 1 â€” Build Go binary
# ------------------------------------------
FROM golang:1.23.10-alpine3.22 AS builder

# Instala git e outras dependÃªncias bÃ¡sicas
RUN apk add --no-cache git

WORKDIR /app

# Copia go.mod + go.sum e baixa deps
COPY go.mod go.sum ./
RUN go mod download

# Copia tudo
COPY . .

# Compila o binÃ¡rio do AGENT
RUN go build -o agent ./cmd/agent/agent.go

# ------------------------------------------
# ðŸš€ Stage 2 â€” Imagem final minimalista
# ------------------------------------------
FROM alpine:latest

WORKDIR /app

# Copia binÃ¡rio do builder
COPY --from=builder /app/agent .


# Comando de inicializaÃ§Ã£o
ENTRYPOINT ["./agent"]
